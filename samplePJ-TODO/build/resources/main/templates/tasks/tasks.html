<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚¿ã‚¹ã‚¯ä¸€è¦§</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h1 class="mb-4 text-center">ğŸ“‹ ã‚¿ã‚¹ã‚¯ä¸€è¦§</h1>
    <div class="d-flex justify-content-between mb-3">
        <button class="btn btn-success" id="createBtn">ï¼‹ æ–°è¦ä½œæˆ</button>
        <button class="btn btn-secondary" id="logoutBtn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>
    <table class="table table-striped table-hover">
        <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
            <th>å†…å®¹</th>
            <th>ç™»éŒ²è€…</th>
            <th>é–‹å§‹æ—¥</th>
            <th>çµ‚äº†æ—¥</th>
            <th>æ“ä½œ</th>
        </tr>
        </thead>
        <tbody id="taskBody"></tbody>
    </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    loadTasks();

    document.getElementById("createBtn").addEventListener("click", () => {
        const title = prompt("ã‚¿ã‚¤ãƒˆãƒ«:");
        const content = prompt("å†…å®¹:");
        if (title && content) {
            fetch("/api/tasks", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({title, content})
            }).then(loadTasks);
        }
    });

    document.getElementById("logoutBtn").addEventListener("click", () => {
        fetch("/api/auth/logout", {method: "POST"})
            .then(() => window.location.href = "/login");
    });
});

function loadTasks() {
    fetch("/api/tasks")
        .then(res => {
            if (!res.ok) throw new Error("Unauthorized");
            return res.json();
        })
        .then(tasks => {
            const tbody = document.getElementById("taskBody");
            tbody.innerHTML = "";
            tasks.forEach(task => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${task.id}</td>
                    <td>${task.title}</td>
                    <td>${task.content}</td>
                    <td>${task.name}</td>
                    <td>${task.startDate || "-"}</td>
                    <td>${task.endDate || "-"}</td>
                    <td>
                        <button class="btn btn-sm btn-primary me-1" onclick="editTask(${task.id})">âœ ç·¨é›†</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteTask(${task.id})">ğŸ—‘ å‰Šé™¤</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }).catch(() => {
            alert("ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡ã‚Œã§ã™ã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ç›´ã—ã¦ãã ã•ã„ã€‚");
            window.location.href = "/login";
        });
}

function editTask(id) {
    const title = prompt("æ–°ã—ã„ã‚¿ã‚¤ãƒˆãƒ«:");
    const content = prompt("æ–°ã—ã„å†…å®¹:");
    if (title && content) {
        fetch(`/api/tasks/${id}`, {
            method: "PUT",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({title, content})
        }).then(loadTasks);
    }
}

function deleteTask(id) {
    if (confirm("æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
        fetch(`/api/tasks/${id}`, {method: "DELETE"})
            .then(loadTasks);
    }
}
</script>
</body>
</html>
